# Testwork Fanbox
***
## Q2 Задание:

> Реализуйте web-приложение (Rails проект), которое удовлетворяет
> нижеизложенным требованиям.
> • Приложение содержит две страницы: / и /admin
> • На странице / отображается текущий курс доллара к рублю, известный
> приложению.
> • Приложение фоновым скриптом периодически обновляет курс из любого
> выбранного вами доступного источника (сайт CBR, главная страница
> http://www.rbc.ru, и т.д.).
> • При обновлении курса в приложении он обновляется на всех открытых в
> текущий момент страницах /.
> • На странице /admin находится форма, содержащая поле для ввода числа,
> поле для ввода даты-времени и сабмит.
> • При сабмите введенное число делается форсированным курсом до введённого
> времени, т.е. до этого времени реальный курс игнорируется, вместо него
> страницах / отображается форсированный курс. 
> • Страница /admin «помнит» введенные предыдущий раз значения, они
> отображаются уже введенными при загрузке страницы.
> • При сабмите форсированного курса он, конечно же, cразу обновляется на всех
> открытых страницах /. При истечении времени действия форсированного
> курса на всех страницах начинает отображаться реальный курс.
> • Форма содержит разумные валидации.
> • Внешний вид приложения должен быть аккуратным в рамках разумного
> (например, использовать Twitter Bootstrap).
> • Плюсом будет использование какого-либо JS-фреймворка на клиентской
> стороне.
> • Web-приложение должно корректно работать в браузерах Firefox и Chrome
> последних версий.
> • Код должен быть покрыт тестами.

## Выполнение
1. Для обновления данных нужен вебсокет, использовал Cable.
2. Для получения новых новостей использую воркер написаный на Sidekiq.
3. Чтобы парсер не попадал в спам использую Phantomjs а результаты его работы
   разбираю Nokogiri
4. Вынес сложные операции из моделей <https://mkdev.me/posts/paru-slov-pro-interaktory-v-rails>
5. Храню курс cкопированный с сервера отдельно. Так-как нас интересует только последний
   курс, то храню его в redis как строка. 
6. Использую React на клиенской стороне, для ускорения перерисовки новостей.
7. Использованы локали
8. Так-как использую много всего специфичного, то использую Docker.


## Запуск
1. `docker-compose build`
2. `docker-compose up -d` ждем 5-10 10 10 10 10 10 10 10 10 10 10 минут
3. `docker exec testwork_web_1  bash -l -c "bundle exec rake db:migrate"`
4. `docker exec testwork_web_1  bash -l -c "RAILS_ENV=test && bundle exec rspec spec"`

## Эксплуатация
* При заполнении в админке, надо указывать время завершения, по умолчанию
время завершение текущее, тоесть показывать не будет.
* Если есть 2 пользовательских курса 1 выводится тот, что имеет большее время
  до истечения показа.

